#!/usr/bin/env ruby

require 'traveller_rpg'
require 'traveller_rpg/careers'
require 'traveller_rpg/generator'
require 'traveller_rpg/career_path'

char = TravellerRPG::Generator.character
puts
puts char.report(stuff: false, credits: false)
puts

path = TravellerRPG::CareerPath.new(char)

careers = %w{Scout Agent}

loop {
  careers = careers.select { |c| path.eligible? c }
  if careers.empty?
    puts "No eligible careers available!"
    break
  end
  career = TravellerRPG.choose("Choose a career", *careers)
  career = TravellerRPG.career_class(career).new(char)

  # skip draft / drifter for now
  accepted = false
  accepted = path.apply(career) while !accepted

  # run consecutive terms of this career
  loop {
    career.run_term
    break unless career.active?
    break if career.must_exit?
    next if career.must_remain?
    break if TravellerRPG.choose("Muster out?", :yes, :no) == :yes
  }
  path.muster_out

  puts "\n" * 2
  puts path.careers.last.report
  puts "\n" * 2
  puts char.report
  puts "\n" * 2

  break if TravellerRPG.choose("Exit career mode?", :yes, :no) == :yes
}

puts "DONE"
